<div ng-controller="DeviceCtrl">
  <div ng-controller="AccountCtrl">

    <div class="alert alert-danger alert-inconsistent"
         ng-show="account.isInconsistent()">
      <strong>Warning!</strong> Account balance information is inconsistent.
    </div>

    <ng-include src="'views/account/nav.html'"></ng-include>

    <div class="tab-content">
      <table class="txlist table table-hover"
             ng-show="account.transactions != null && account.transactions.length">
        <thead>
          <tr class="text-muted">
            <th width="20%">Timestamp</th>
            <th class="txlist-header-address">Address</th>
            <th width="16%" class="txlist-header-amount">Amount</th>
            <th width="16%">Balance</th>
          </tr>
        </thead>
        <tbody>
          <tr class="txlist-tx"
              ng-repeat="tx in account.transactions"
              ng-class="{ 'selected': tx.active }"
              tooltip="Click to see transaction details and to label the addresses."
              ng-click="tx.active = !tx.active">
            <td class="txlist-date"
                ng-if="tx.block">
              {{tx.timestamp | date:'yyyy-MM-dd'}}
              <small class="text-muted">{{tx.timestamp | date:'HH:mm:ss'}}</small>
            </td>
            <td class="txlist-date text-center text-muted"
                ng-if="!tx.block">
              <small title="Transaction received at {{tx.timestamp | date:'yyyy-MM-dd HH:mm:ss'}}"
                >Unconfirmed</small>
            </td>
            <td ng-if="!tx.active"
                ng-switch="tx.analysis.type">
              <div class="txlist-address">
                <a href="{{blockExplorer.urlTx}}{{tx.hash}}"
                   class="txlist-hash"
                   target="_blank"
                   title="Transaction info at {{blockExplorer.name}}"
                   ><span class="glyphicon glyphicon-info-sign"></span></a>
                <span class="text-success" ng-switch-when="recv">
                  <span class="glyphicon glyphicon-circle-arrow-right"
                    title="Received"></span>
                  <span ng-if="tx.label" title="{{tx.analysis.addr.toString()}}">
                    {{tx.label}}
                  </span>
                  <span ng-if="!tx.label">
                    {{tx.analysis.addr.toString()}}
                  </span>
                </span>
                <span class="text-danger" ng-switch-when="sent">
                  <span class="glyphicon glyphicon-circle-arrow-left"
                    title="Sent"></span>
                  <span ng-if="tx.label" title="{{tx.analysis.addr.toString()}}">
                    {{tx.label}}
                  </span>
                  <span ng-if="!tx.label">
                    {{tx.analysis.addr.toString()}}
                  </span>
                </span>
                <span class="text-warning" ng-switch-when="self">
                  <span class="glyphicon glyphicon-user"></span> Sent to myself
                </span>
                <span class="text-muted" ng-switch-default>
                  <span class="glyphicon glyphicon-question-sign"></span> Unknown
                </span>
              </div>
            </td>
            <td ng-if="tx.active"
                ng-switch="tx.analysis.type">
              <div class="txlist-address">
                <a href="{{blockExplorer.urlTx}}{{tx.hash}}"
                   class="txlist-hash"
                   target="_blank"
                   title="Transaction info at {{blockExplorer.name}}"
                   ><span class="glyphicon glyphicon-info-sign"></span></a>
                <span class="text-success" ng-switch-when="recv">
                  <span class="glyphicon glyphicon-circle-arrow-right"
                    title="Received"></span>
                  {{tx.analysis.addr.toString()}}
                </span>
                <span class="text-danger" ng-switch-when="sent">
                  <span class="glyphicon glyphicon-circle-arrow-left"
                    title="Sent"></span>
                  {{tx.analysis.addr.toString()}}
                </span>
                <span class="text-warning" ng-switch-when="self">
                  <span class="glyphicon glyphicon-user"></span> Sent to myself
                </span>
                <span class="text-muted" ng-switch-default>
                  <span class="glyphicon glyphicon-question-sign"></span> Unknown
                </span>
              </div>
              <form role="form" class="txlist-label"
                ng-submit="">
                <input type="text" class="form-control"
                  placeholder="Give your own label to this address"
                  ng-model="tx.label"
                  ng-click="$event.stopPropagation()">
              </form>
            </td>
            <td class="txlist-amount"
                ng-class="{ 'text-success': tx.analysis.impact.sign > 0,
                            'text-danger': tx.analysis.impact.sign < 0 }">
              {{tx.analysis.impact.sign | sign}}{{tx.analysis.impact.value | amount}}
            </td>
            <td class="txlist-balance"
                ng-repeat-end>
              {{tx.balance | amount}}
            </td>
          </tr>
        </tbody>
      </table>

      <div class="txlist-empty text-center text-muted"
           ng-show="account.transactions != null && !account.transactions.length">
        <h4>No transactions to display</h4>
        <button class="btn btn-default"
                ng-show="device.canHideAccount(account)"
                ng-click="hideAccount()"
          >Hide this account</button>
      </div>

      <div class="txlist-loading text-center text-muted"
           ng-show="account.transactions == null">
        <span class="icon-loading" title="Loading transactions..."></span>
      </div>
    </div>
  </div>
</div>
